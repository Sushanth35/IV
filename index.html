<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grocery Store Survey Dashboard</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: black; color: white; }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: 3em; font-weight: bold; color: white; }
    .filter { margin-bottom: 20px; text-align: center; }
    label { color: white; }
    select { background-color: black; color: white; border: 1px solid gray; }
    .charts-row { display: flex; justify-content: space-around; flex-wrap: wrap; margin-bottom: 20px; }
    .chart { width: 30%; background: #111; padding: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(255,255,255,0.1); margin-bottom: 20px; min-height: 460px; position: relative; }
    svg { width: 100%; height: 400px; background: transparent; }
    text, .tick text { fill: white; }
    .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: gray; }
    .tooltip { position: absolute; text-align: center; padding: 6px; font-size: 12px; background: lightsteelblue; border-radius: 5px; pointer-events: none; opacity: 0; color: black; }
    .no-data { text-align: center; color: gray; padding-top: 100px; font-size: 18px; }
  </style>
</head>
<body>
  <div class="header">
    <h1>Grocery Store Survey Dashboard</h1>
  </div>
  <div class="filter">
    <label for="genderFilter">Filter by Gender:</label>
    <select id="genderFilter"><option value="All">All</option></select>
    <label for="paymentFilter" style="margin-left:20px;">Filter by Payment Method:</label>
    <select id="paymentFilter"><option value="All">All</option></select>
    <label for="chainFilter" style="margin-left:20px;">Filter by Chain:</label>
    <select id="chainFilter"><option value="All">All</option></select>
  </div>
  <div class="charts-row">
    <div class="chart" id="barChart"></div>
    <div class="chart" id="pieChart"></div>
    <div class="chart" id="boxPlot"></div>
  </div>
  <div class="footer">
    Created by Harshitha Patlolla, Varun Sai Arutla, Lakshmi Mattaparthi, Sushanth Malliboina
  </div>
  <div id="tooltip" class="tooltip"></div>
<script>
// Existing logic...
// Replace only drawBoxPlot function with animated transitions
function drawBoxPlot(filtered) {
  const id = "boxPlot";
  d3.select(`#${id}`).html("");
  if (filtered.length === 0) { showNoData(id); return; }
  const svg = d3.select(`#${id}`).append("svg"),
        margin = {top: 20, right: 20, bottom: 50, left: 50},
        width = svg.node().clientWidth - margin.left - margin.right,
        height = svg.node().clientHeight - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
  const chainGroups = d3.groups(filtered, d => d.Chain);
  const x = d3.scaleBand().domain(chainGroups.map(d => d[0])).range([0, width]).padding(0.2);
  const y = d3.scaleLinear().domain([0, d3.max(filtered, d => d.PurchaseAmount)]).nice().range([height, 0]);
  g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x));
  g.append("g").call(d3.axisLeft(y));
  const boxWidth = x.bandwidth();
  chainGroups.forEach(([chain, group]) => {
    const values = group.map(d => d.PurchaseAmount).sort(d3.ascending);
    const q1 = d3.quantile(values, 0.25);
    const median = d3.quantile(values, 0.5);
    const q3 = d3.quantile(values, 0.75);
    const iqr = q3 - q1;
    const lowerWhisker = Math.max(d3.min(values), q1 - 1.5 * iqr);
    const upperWhisker = Math.min(d3.max(values), q3 + 1.5 * iqr);
    const xCenter = x(chain) + boxWidth / 2;
    g.append("rect")
      .attr("x", x(chain))
      .attr("y", y(q3))
      .attr("width", boxWidth)
      .attr("height", 0)
      .transition().duration(800)
      .attr("height", y(q1) - y(q3))
      .attr("fill", "#4FC3F7");
    g.append("line")
      .attr("x1", x(chain))
      .attr("x2", x(chain) + boxWidth)
      .attr("y1", y(median))
      .attr("y2", y(median))
      .attr("stroke", "#FF7043").attr("stroke-width", 2);
    g.append("line")
      .attr("x1", xCenter).attr("x2", xCenter)
      .attr("y1", y(lowerWhisker)).attr("y2", y(q1))
      .attr("stroke", "#FF7043");
    g.append("line")
      .attr("x1", xCenter).attr("x2", xCenter)
      .attr("y1", y(upperWhisker)).attr("y2", y(q3))
      .attr("stroke", "#FF7043");
    group.forEach(d => {
      if (d.PurchaseAmount < lowerWhisker || d.PurchaseAmount > upperWhisker) {
        g.append("circle")
          .attr("cx", xCenter).attr("cy", y(d.PurchaseAmount))
          .attr("r", 0)
          .transition().duration(500)
          .attr("r", 3)
          .attr("fill", "#FF7043");
      }
    });
  });
  svg.append("text")
    .attr("x", width / 2 + margin.left)
    .attr("y", 15)
    .attr("text-anchor", "middle")
    .style("font-size", "16px")
    .text("Purchase Amount Distribution by Chain");
}
</script>
</body>
</html>
